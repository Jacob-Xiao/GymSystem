# 器材预约功能说明

## 功能概述

为会员界面添加了器材预约功能，允许会员预约器材使用时间，并支持分享请求功能。

## 数据库变更

### 新增表

1. **equipment_booking** - 器材预约表
   - booking_id: 预约ID（主键）
   - equipment_id: 器材ID
   - member_account: 预约会员账号
   - member_name: 预约会员姓名
   - start_time: 开始时间
   - end_time: 结束时间
   - location_note: 训练地址备注
   - status: 状态（active-有效，cancelled-已取消，completed-已完成）
   - created_at: 创建时间

2. **equipment_share_request** - 器材分享请求表
   - request_id: 请求ID（主键）
   - booking_id: 预约ID
   - requester_account: 请求者会员账号
   - requester_name: 请求者姓名
   - status: 状态（pending-待处理，accepted-已接受，rejected-已拒绝）
   - created_at: 创建时间

## 数据库初始化

运行以下SQL脚本创建表：

```bash
mysql -u root -p gym_management_system < equipment_booking.sql
```

或者在MySQL客户端中执行 `equipment_booking.sql` 文件。

## 功能特性

### 1. 器材预约列表
- 显示所有可用器材
- 选择器材查看当前预约信息
- 器材状态显示（正常/损坏/维修中）

### 2. 创建预约（器材空闲时）
- 选择开始时间和结束时间
- 添加训练地址备注（可选）
- 自动检测时间冲突
- 验证时间有效性（不能预约过去时间，结束时间必须晚于开始时间）

### 3. 查看预约详情
- 显示预约的完整信息
- 显示器材信息
- 显示预约会员信息
- 显示训练地址备注
- 预约所有者可以取消预约

### 4. 分享请求功能

#### 对于预约所有者：
- 查看所有收到的分享请求
- 接受或拒绝分享请求
- 查看分享请求历史记录

#### 对于其他会员：
- 查看已预约的器材信息
- 查看预约会员信息
- 查看训练地址备注
- 提交分享请求
- 查看自己发送的分享请求状态

## API端点

### 器材预约相关

- `GET /api/equipment-booking/equipment/list` - 获取所有器材列表
- `GET /api/equipment-booking/equipment/:equipmentId/bookings` - 获取器材的预约信息
- `GET /api/equipment-booking/member/:memberAccount/bookings` - 获取会员的预约列表
- `GET /api/equipment-booking/booking/:bookingId` - 获取预约详情
- `POST /api/equipment-booking/booking/create` - 创建预约
- `DELETE /api/equipment-booking/booking/:bookingId/member/:memberAccount` - 取消预约

### 分享请求相关

- `POST /api/equipment-booking/share-request/create` - 创建分享请求
- `GET /api/equipment-booking/member/:memberAccount/share-requests/received` - 获取收到的分享请求
- `GET /api/equipment-booking/member/:memberAccount/share-requests/sent` - 获取发送的分享请求
- `POST /api/equipment-booking/share-request/:requestId/handle` - 处理分享请求（接受/拒绝）

## 前端页面

### 1. 器材预约页面 (`/user/equipment-booking/:account`)
- 左侧：器材列表
- 右侧：预约信息/创建预约表单
- 显示当前预约信息
- 支持创建新预约
- 支持查看详情和申请分享

### 2. 预约详情页面 (`/user/equipment-booking/detail/:bookingId/:memberAccount`)
- 显示预约完整信息
- 预约所有者可以处理分享请求
- 预约所有者可以取消预约
- 显示分享请求历史

## 使用流程

### 创建预约流程

1. 会员登录后，进入"器材预约"页面
2. 从左侧列表选择器材
3. 如果器材空闲，点击"新建预约"
4. 填写开始时间、结束时间和备注（可选）
5. 提交预约

### 申请分享流程

1. 会员查看已预约的器材信息
2. 点击"申请分享"按钮
3. 系统向预约所有者发送分享请求
4. 预约所有者可以在预约详情页面处理请求

### 处理分享请求流程

1. 预约所有者进入预约详情页面
2. 查看收到的分享请求
3. 选择"接受"或"拒绝"
4. 请求者可以在自己的请求列表中查看状态

## 注意事项

1. **时间冲突检测**：系统会自动检测时间冲突，不能预约已被占用的时间段
2. **时间验证**：不能预约过去的时间，结束时间必须晚于开始时间
3. **权限控制**：
   - 只有预约所有者可以取消预约
   - 只有预约所有者可以处理分享请求
   - 不能向自己的预约申请分享
4. **状态管理**：预约状态包括 active（有效）、cancelled（已取消）、completed（已完成）
5. **分享请求状态**：pending（待处理）、accepted（已接受）、rejected（已拒绝）

## 后续扩展建议

1. 添加预约提醒功能（邮件/短信）
2. 添加预约评价功能
3. 添加预约历史记录
4. 添加器材使用统计
5. 添加多人预约功能（一个预约允许多个会员共享）
6. 添加预约自动取消功能（超时未确认）
