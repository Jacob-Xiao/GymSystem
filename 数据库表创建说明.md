# 器材预约功能数据库表创建说明

## 问题
提交预约时出现错误：`Table 'gym_management_system.equipment_booking' doesn't exist`

## 解决方案

需要创建两个新表来支持器材预约功能。

### 方法1：使用SQL脚本（推荐）

在项目根目录下，运行以下命令：

```bash
mysql -u root -p gym_management_system < equipment_booking.sql
```

### 方法2：在MySQL客户端中执行

1. 打开MySQL客户端（命令行或MySQL Workbench）
2. 连接到数据库：
   ```sql
   USE gym_management_system;
   ```
3. 执行 `equipment_booking.sql` 文件中的所有SQL语句

### 方法3：手动执行SQL

在MySQL客户端中执行以下SQL语句：

```sql
USE gym_management_system;

-- 器材预约表
CREATE TABLE IF NOT EXISTS `equipment_booking` (
  `booking_id` int NOT NULL AUTO_INCREMENT COMMENT '预约ID',
  `equipment_id` int NOT NULL COMMENT '器材ID',
  `member_account` int NOT NULL COMMENT '预约会员账号',
  `member_name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '预约会员姓名',
  `start_time` datetime NOT NULL COMMENT '开始时间',
  `end_time` datetime NOT NULL COMMENT '结束时间',
  `location_note` varchar(500) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '训练地址备注',
  `status` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT 'active' COMMENT '状态：active-有效，cancelled-已取消，completed-已完成',
  `created_at` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`booking_id`) USING BTREE,
  INDEX `idx_equipment_id` (`equipment_id`) USING BTREE,
  INDEX `idx_member_account` (`member_account`) USING BTREE,
  INDEX `idx_time` (`start_time`, `end_time`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = '器材预约表' ROW_FORMAT = Compact;

-- 器材分享请求表
CREATE TABLE IF NOT EXISTS `equipment_share_request` (
  `request_id` int NOT NULL AUTO_INCREMENT COMMENT '请求ID',
  `booking_id` int NOT NULL COMMENT '预约ID',
  `requester_account` int NOT NULL COMMENT '请求者会员账号',
  `requester_name` varchar(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL COMMENT '请求者姓名',
  `status` varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT 'pending' COMMENT '状态：pending-待处理，accepted-已接受，rejected-已拒绝',
  `created_at` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`request_id`) USING BTREE,
  INDEX `idx_booking_id` (`booking_id`) USING BTREE,
  INDEX `idx_requester` (`requester_account`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT = '器材分享请求表' ROW_FORMAT = Compact;
```

## 验证表是否创建成功

执行以下SQL查询验证：

```sql
USE gym_management_system;

-- 查看表是否存在
SHOW TABLES LIKE 'equipment_%';

-- 应该看到：
-- equipment
-- equipment_booking
-- equipment_share_request

-- 查看表结构
DESCRIBE equipment_booking;
DESCRIBE equipment_share_request;
```

## 注意事项

1. **确保数据库名称正确**：确保连接的是 `gym_management_system` 数据库
2. **权限问题**：确保MySQL用户有创建表的权限
3. **字符集**：表使用utf8字符集，支持中文
4. **存储引擎**：使用InnoDB引擎，支持事务和外键

## 创建表后的下一步

1. 重启后端服务（如果正在运行）
2. 刷新前端页面
3. 测试预约功能
