# 健身房管理系统 - 运行指南

## 前置要求

在开始之前，请确保已安装以下软件：

1. **Node.js** (推荐 v16 或更高版本)
   - 下载地址: https://nodejs.org/
   - 验证安装: 在命令行运行 `node -v` 和 `npm -v`

2. **MySQL 8.0+**
   - 确保 MySQL 服务已启动
   - 验证安装: 在命令行运行 `mysql --version`

## 第一步：配置数据库

### 1.1 创建数据库

打开 MySQL 命令行或 MySQL Workbench，执行：

```sql
CREATE DATABASE gym_management_system;
```

### 1.2 导入数据库脚本

在项目根目录下，执行：

```bash
mysql -u root -p gym_management_system < gym_management_system.sql
```

或者在 MySQL 客户端中：
1. 选择 `gym_management_system` 数据库
2. 执行 `gym_management_system.sql` 文件中的所有 SQL 语句

<<<<<<< HEAD
若使用器材预约功能，还需执行：
- `equipment_booking.sql`（器材预约表、分享请求表）
- `equipment_training_record.sql`（器材预约训练计划/记录表）

=======
>>>>>>> a749d3276ce155fbc74c959ecfae055ceee5008a
### 1.3 验证数据库

检查表是否创建成功：

```sql
USE gym_management_system;
SHOW TABLES;
```

应该看到以下表：
- admin
- member
- employee
- equipment
- class_table
- class_order

## 第二步：配置后端

### 2.1 进入后端目录

```bash
cd backend
```

### 2.2 安装依赖

```bash
npm install
```

### 2.3 配置环境变量

在 `backend` 目录下创建 `.env` 文件（如果还没有），内容如下：

```env
PORT=3001
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=你的MySQL密码
DB_NAME=gym_management_system
JWT_SECRET=your-secret-key-change-in-production
```

**重要说明**:
- 将 `DB_PASSWORD` 替换为你的 MySQL root 密码
- `JWT_SECRET` 当前代码中未使用，可以设置任意字符串（如：`my-gym-secret-key-2024`）。如果将来添加JWT认证功能，这个密钥将用于签名token，建议使用随机、复杂的字符串

### 2.4 启动后端服务

```bash
npm start
```

或者使用开发模式（自动重启）：

```bash
npm run dev
```

如果成功，你会看到：
```
Server is running on port 3001
```

**保持这个终端窗口打开！**

## 第三步：配置前端

### 3.1 打开新的终端窗口

保持后端服务运行，打开一个新的终端窗口。

### 3.2 进入前端目录

```bash
cd frontend
```

### 3.3 安装依赖

```bash
npm install
```

**注意**: 这可能需要几分钟时间，因为需要下载 React 和相关依赖。

### 3.4 启动前端开发服务器

```bash
npm start
```

如果成功，浏览器会自动打开 `http://localhost:3000`

如果没有自动打开，请手动访问：http://localhost:3000

## 第四步：访问系统

### 管理员登录
- 访问: http://localhost:3000/admin/login
- 账号: 1001
- 密码: 123456

### 会员登录
- 访问: http://localhost:3000/user/login
- 账号: 202100788
- 密码: 123456

## 常见问题解决

### 问题1: npm install 失败

**解决方案**:
- 检查网络连接
- 尝试使用国内镜像：
  ```bash
  npm config set registry https://registry.npmmirror.com
  ```
- 清除 npm 缓存：`npm cache clean --force`

### 问题2: 后端无法连接数据库

**错误信息**: `Error: connect ECONNREFUSED` 或 `Access denied`

**解决方案**:
1. 检查 MySQL 服务是否启动
   - Windows: 在服务管理器中检查 MySQL 服务
   - Mac/Linux: `sudo service mysql status`
2. 检查 `.env` 文件中的数据库配置是否正确
3. 确认数据库用户名和密码正确
4. 确保数据库 `gym_management_system` 已创建

### 问题3: 端口被占用

**错误信息**: `Error: listen EADDRINUSE: address already in use :::3001`

**解决方案**:
- 后端端口被占用：修改 `backend/.env` 中的 `PORT` 值
- 前端端口被占用：修改 `frontend/package.json` 中的脚本，添加 `PORT=3002`
  ```json
  "start": "PORT=3002 react-scripts start"
  ```

### 问题4: 前端无法连接后端

**解决方案**:
1. 确保后端服务正在运行（检查终端1）
2. 检查后端是否运行在 `http://localhost:3001`
3. 检查浏览器控制台（F12）查看错误信息

### 问题5: 页面显示空白

**解决方案**:
1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页的错误信息
3. 检查 Network 标签页，确认 API 请求是否成功
4. 确保后端服务正常运行

## 开发模式说明

### 后端开发模式
使用 `npm run dev` 启动后端，代码修改后会自动重启服务器（需要安装 nodemon）。

### 前端开发模式
使用 `npm start` 启动前端，代码修改后浏览器会自动刷新。

## 停止服务

- 在运行服务的终端窗口中按 `Ctrl + C`
- 需要同时停止后端和前端服务

## 生产环境部署

### 构建前端
```bash
cd frontend
npm run build
```

这会生成 `build` 目录，包含优化后的生产文件。

### 运行后端（生产环境）
```bash
cd backend
npm start
```

## 测试账号

### 管理员账号
- 账号: 1001, 1002, 1003
- 密码: 123456

### 会员账号
- 账号: 202100788, 202132539, 202156754 等
- 密码: 123456

更多测试数据请查看数据库脚本。
